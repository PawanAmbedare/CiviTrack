{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}

{% block content %}
  <h2>Reported Potholes</h2>
  <form method="get" class="filters" style="margin-bottom:12px;display:flex;gap:8px;flex-wrap:wrap;align-items:center">
    <label>Severity
      <select name="severity">
        <option value="">All</option>
        {% for key, label in severity_choices %}
          <option value="{{ key }}" {% if selected_severity == key %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </label>
    <label>Status
      <select name="status">
        <option value="">All</option>
        {% for key, label in status_choices %}
          <option value="{{ key }}" {% if selected_status == key %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </label>
    <button class="btn" type="submit">Filter</button>
    <a class="btn" href="{% url 'dashboard' %}" style="background:#6c757d">Reset</a>
  </form>

  <div class="grid">
    {% for r in reports %}
      <div class="card">
        {% if r.image %}
          <img src="{{ r.image.url }}" alt="{{ r.title }}">
        {% else %}
          <div class="placeholder">No image</div>
        {% endif %}
        <h3>{{ r.title }}</h3>
        <p class="meta">Severity: {{ r.get_severity_display }} â€” Status: {{ r.get_status_display }}</p>
        <p>{{ r.description|linebreaksbr }}</p>
        {% if r.latitude and r.longitude %}
          <p class="location">Location: {{ r.latitude }}, {{ r.longitude }}</p>
        {% endif %}
        {% if request.user.is_staff %}
          <form method="post" action="{% url 'update_status' r.pk %}" style="margin-top:8px">
            {% csrf_token %}
            <label style="font-weight:600;font-size:0.9rem">Change Status
              <select name="status">
                {% for key,label in status_choices %}
                  <option value="{{ key }}" {% if r.status == key %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
              </select>
            </label>
            <button class="btn" type="submit" style="margin-left:8px">Update</button>
          </form>
        {% endif %}
      </div>
    {% empty %}
      <p>No reports yet.</p>
    {% endfor %}
  </div>
{% endblock %}
